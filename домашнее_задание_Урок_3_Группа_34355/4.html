<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Homework</title>
  </head>
  <body>
    <!--
Обязательное задание.

1. Необходимо вывести в консоль массив продуктов в котором есть хоть одна
фотография используя метод filter. Исходные данные - массив products.
2. Необходимо отсортировать массив products используя метод sort по цене,
начиная с самой маленькой, заканчивая самой большой ценой, после чего вывести
отсортированный массив в консоль.
-->
    <script>
      'use strict';

      const products = [
        {
          id: 3,
          price: 127,
          photos: ['1.jpg', '2.jpg'],
        },
        {
          id: 5,
          price: 499,
          photos: [],
        },
        {
          id: 10,
          price: 26,
          photos: ['3.jpg'],
        },
        {
          id: 8,
          price: 78,
        },
      ];

      /*
      1. Необходимо вывести в консоль массив продуктов в котором есть хоть одна
      фотография используя метод filter. Исходные данные - массив products.

      Решение:
      создаем результирующий массив result на основе метода filter
      примененного к исходному массиву products
      для условий фильтрации создаем логическую (да да, ту самую, которая возвращает булеан)
      callback функцию с параметром product
      Эта функция проверяет с помощью оператора in ('photos' in product) наличие ключа 'photos' (это перечислимое свойство объекта) 
      в проверяемом объекте исходного массива (возврат True или False)
      https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/in
      и (логическое И - &&) то, что длина строки значения этого ключа ненулевая, (product.photos.length !== 0)
      (возврат True или False), причем при применении метода .length строка динамически представляется
      массивом.
      И если в итоге callback функция возвращает True, то проверяемый объект проходит фильтрацию
      и добавляется в результирующий массив result.
      Уточнение: проверка на наличие ключа должна происходить раньше, чем проверка его длины,
      дабы избежать undefined.
      Но если применить оператор опциональной последовательности ? который позволяет получить значение
      свойства, находящегося на любом уровне вложенности в цепочке связанных между собой объектов, без
      необходимости проверять каждое из промежуточных свойств в ней на существование
      (если не существует, то undefined), то получим сразу
      True или False - т.е. если ключа 'photos' в данном проверяемом объекте нет,
      то при проверке его длины (product.photos?.length !== 0) сразу получим False и не получим это:
      Uncaught TypeError: Cannot read properties of undefined (reading 'length')
      */
      const result = products.filter(function (product) {
        //return 'photos' in product && product.photos.length !== 0; // это таботает
        return product.photos?.length !== 0 && 'photos' in product; // и это работает
      });
      console.log(result);
      /*
      После того, как написал работающий развернутый вариант, его можно скократить
      до стрелочной функции.
      Вариант с использованием стрелочной callback функции
      где объявленный параметр этой функции product пробегается по всем значениям
      ключа/свойства 'photos' исходного массива products и получает значение
      из этого массива в виде такой конструкции product.photos
      Применяем оператор опциональной последовательности ? (см. его описание выше)
      и исключаем появление ошибки
      */
      console.log(products.filter(product => product.photos?.length !== 0 && 'photos' in product));

      /*
      2. Необходимо отсортировать массив products используя метод sort по цене,
      начиная с самой маленькой, заканчивая самой большой ценой, после чего вывести
      отсортированный массив в консоль.

      Решение:
      Для числового сравнения, вместо строкового, функция сравнения может просто вычитать b из a.
      функция будет сортировать массив по возрастанию. Если по убыванию, тогда a из b.
      https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
      см доп материал к 3-му уроку файл "как работает метод sort.mp4"

      Пересоздаем исходный массив products на основе метода filter примененного к самому себе.
      Для условий сортировки создаем callback функцию сравнения, принимающую два параметра a и b из объектов,
      содержащихся в массиве. Поскольку нам надо сравнить значения под конкретным ключем/свойством объектов "price" 
      то в качестве аргументов используем форму написания a.price и b.price - это значит,
      что на данном шаге сравнения под параметр "a" идет некий аргумент из одного объекта, 
      содержащегося в массиве products под ключем "price" и он обозначается как a.price.
      Аналогично другой аргумент из другого объекта, содержащегося в этом же массиве products
      под ключем "price" идет под параметр "b" и обозначается как b.price. И так методом sort
      перебираются значения заданного ключа/свойства (в нашем случае это "price") во всех объектах массива products 
      и при получении отрицательного значения функции сравнения
      индекс объекта из которого было передано значение для "a" (a.price) будет преназначен на меньший,
      а для "b" (b.price) на больший из этой пары.
      При получении положительного значения функции сравнения переназначение инвертируется.
      В случае нулевого значения функции сравнения переназначения индексов не произойдет.
      */
      // сортировка по возрастанию
      /*
      products.sort(function (a, b) {
      return a.price - b.price;
      });
      */
      // и стрелочная функция
      products.sort((a, b) => a.price - b.price);
      // сортировка по убыванию
      /*
      products.sort(function(a, b) {
        return b.price - a.price;
      });
      */
      // Универсальный метод сортировка по возрастанию
      /*
      products.sort(function(a, b) {
        if (a.price > b.price) {return 1;}
        if (a.price < b.price) {return -1;}
        return 0;
      });
      */
      // Универсальный метод сортировка по убыванию
      /*
      products.sort(function(a, b) {
        if (a.price < b.price) {return 1;}
        if (a.price > b.price) {return -1;}
        return 0;
      });
      */
      console.log(products);
    </script>
  </body>
</html>
